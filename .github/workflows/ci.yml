name: CI

on:
    push:
        branches: [main]
    pull_request:
        branches: [main]

jobs:
    build-and-test:
        runs-on: ${{ matrix.os }}
        strategy:
            matrix:
                os: [ubuntu-latest, macos-latest]

        steps:
            - uses: actions/checkout@v4

            - name: Install dependencies (Ubuntu)
              if: runner.os == 'Linux'
              run: sudo apt-get update && sudo apt-get install -y build-essential libssl-dev

            - name: Install dependencies (macOS)
              if: runner.os == 'macOS'
              run: brew install openssl

            - name: Build & Test
              run: |
                  make clean
                  make tests
                  ./build/tests/test_parse  # и другие потом
                  make examples
                  # Тест сервера: ./build/examples/minimal_server & sleep 2 && curl -s http://localhost:8080 || echo "Server test skipped (dummy)"

            - name: Check code style (optional)
              run: clang-format --version || echo "No clang-format"
